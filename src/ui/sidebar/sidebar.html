<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cerebr</title>
    <script src="/lib/marked.min.js"></script>
    <script src="/lib/highlight.min.js"></script>
    <script src="/lib/katex.min.js"></script>
    <script src="/lib/auto-render.min.js"></script>
    <script src="/lib/purify.min.js"></script>
    <!-- <script src="/lib/cytoscape.min.js"></script>
    <script src="/lib/dagre.min.js"></script>
    <script src="/lib/cytoscape-dagre.js"></script> -->

    <link rel="stylesheet" href="/lib/fontawesome/css/all.css">
    <link rel="stylesheet" href="/lib/github-dark.css">
    <link rel="stylesheet" href="/lib/katex.min.css">
    <link rel="stylesheet" href="/src/ui/styles/sidebar.css">
</head>
<body>
    <div id="collapse-button"></div>
    <div id="chat-container"></div>
    <div class="empty-state-content">
        <div class="empty-state-icon">
            <i class="far fa-comment-dots"></i>
        </div>
        <h3 class="empty-state-title">开始对话</h3>
        <p class="empty-state-description">在下方输入您的问题，或者尝试以下选项</p>
        <div class="empty-state-actions">
            <div id="empty-state-history" class="empty-state-action">
                <i class="far fa-history"></i>
                <span>查看聊天历史</span>
            </div>
            <div id="empty-state-summary" class="empty-state-action">
                <i class="far fa-file-alt"></i>
                <span>总结当前页面</span>
            </div>
            <div id="empty-state-temp-mode" class="empty-state-action">
                <i class="far fa-bolt"></i>
                <span>纯对话模式</span>
            </div>
            <div id="empty-state-load-url" class="empty-state-action">
                <i class="far fa-link"></i>
                <span>加载本页对话</span>
            </div>
        </div>
    </div>
    <div id="context-menu">
        <div class="context-menu-item" id="copy-message">
            <i class="far fa-copy"></i>
            复制消息
        </div>
        <div class="context-menu-item" id="copy-code" style="display: none;">
            <i class="far fa-code"></i>
            复制代码
        </div>
        <div class="context-menu-item" id="stop-update">
            <i class="far fa-stop"></i>
            停止更新
        </div>
        <div class="context-menu-item" id="delete-message">
            <i class="far fa-trash-alt"></i>
            删除消息
        </div>
        <div class="context-menu-item" id="fork-conversation">
            <i class="far fa-code-branch"></i>
            创建分支对话
        </div>
        <div class="context-menu-item" id="regenerate-message" style="display: none;">
            <i class="far fa-redo"></i>
            重新生成
        </div>
        <div class="context-menu-item" id="clear-chat-context">
            <i class="far fa-trash"></i>
            清空聊天
        </div>
    </div>
    <div id="input-container">
        <div id="image-container"></div>
        <div id="message-row">
            <div id="message-input" contenteditable="plaintext-only" placeholder="输入消息..." role="textbox"></div>
            <button id="screenshot-button" title="截屏页面内容">
                <i class="far fa-camera"></i>
            </button>
            <button id="send-button">↵</button>
            <div id="settings-container">
                <button id="settings-button">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="6" r="2"/>
                        <circle cx="12" cy="12" r="2"/>
                        <circle cx="12" cy="18" r="2"/>
                    </svg>
                </button>
                <div id="settings-menu">
                    <div class="menu-item" id="theme-selector">
                        <div class="theme-preview-grid">
                            <!-- 动态加载主题预览卡片 -->
                        </div>
                        <select id="theme-select" class="theme-select" style="display: none;">
                            <!-- 动态加载主题选项 -->
                        </select>
                        <span class="theme-switch-container" style="display: none;">
                            <label class="switch">
                                <input type="checkbox" id="theme-switch">
                                <span class="slider"></span>
                            </label>
                            <span class="theme-switch-label">深色模式</span>
                        </span>
                        <div class="theme-title">
                            <i class="far fa-palette"></i>
                            <span>主题选择</span>
                        </div>
                    </div>
                    <div class="menu-item">
                        <span>自动滚动</span>
                        <label class="switch">
                            <input type="checkbox" id="auto-scroll-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="menu-item">
                        <span>划词搜索时清空聊天</span>
                        <label class="switch">
                            <input type="checkbox" id="clear-on-search-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="menu-item">
                        <span>发送聊天历史</span>
                        <label class="switch">
                            <input type="checkbox" id="send-chat-history-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="menu-item">
                        <span>显示引用标记</span>
                        <label class="switch">
                            <input type="checkbox" id="show-reference-switch" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="menu-item">
                        <span>侧栏在右侧显示</span>
                        <label class="switch">
                            <input type="checkbox" id="sidebar-position-switch">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="menu-item" id="clear-chat" style="display: none;">
                        <span>清空聊天记录</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M3 4H13" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M5 4V12H11V4" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="menu-item" id="quick-summary" style="display: none;">
                        <span>快速总结</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M2 4h12M2 8h8M2 12h4" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <div class="menu-item" id="favorite-apis" style="display: none;">
                        <span>收藏的API</span>
                        <div class="favorite-apis-list"></div>
                    </div>
                    <div class="menu-item">
                        <span>侧栏宽度</span>
                        <input type="range" id="sidebar-width" min="500" max="1500" step="10" value="800">
                        <span id="width-value">800px</span>
                    </div>
                    <div class="menu-item">
                        <span>字体大小</span>
                        <input type="range" id="font-size" min="12" max="24" step="1" value="14">
                        <span id="font-size-value">14px</span>
                    </div>
                    <div class="menu-item">
                        <span>缩放比例</span>
                        <input type="range" id="scale-factor" min="0.5" max="2" step="0.1" value="1">
                        <span id="scale-value">1.0x</span>
                    </div>
                    <div class="menu-item" id="debug-chat-tree-btn" style="display: none;">
                        <i class="far fa-bug"></i>
                        <span>调试聊天记录树</span>
                    </div>
                    <div class="menu-item" id="prompt-settings-toggle">
                        <i class="far fa-cogs"></i>
                        <span>提示词设置</span>
                    </div>
                    <div class="menu-item" id="api-settings-toggle">
                        <i class="far fa-plug"></i>
                        <span>API 设置</span>
                    </div>
                    <div class="menu-item" id="fullscreen-toggle">
                        <i class="far fa-expand"></i>
                        <span>全屏模式</span>
                    </div>
                    <div class="menu-item" id="chat-history-menu">
                        <i class="far fa-history"></i>
                        <span>聊天记录</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="api-settings">
        <div class="settings-header">
            <button class="back-button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12 4L6 10L12 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <span class="settings-title">API 设置</span>
        </div>
        <div class="api-cards">
            <!-- 卡片模板 -->
            <div class="api-card template" style="display: none;">
                <div class="api-card-header">
                    <div class="api-card-title"></div>
                    <div class="api-card-actions">
                        <button class="card-button select-btn" title="选择">
                            <i class="far fa-check"></i>
                        </button>
                        <button class="card-button favorite-btn" title="收藏">
                            <i class="far fa-star"></i>
                        </button>
                        <button class="card-button duplicate-btn" title="复制">
                            <i class="far fa-clone"></i>
                        </button>
                        <button class="card-button delete-btn" title="删除">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="api-form">
                    <div class="form-group">
                        <div class="form-group-header">
                            <label>API Key</label>
                        </div>
                        <div class="input-wrapper">
                            <input type="password" class="api-key" placeholder="输入 API Key">
                            <button class="toggle-password-btn" title="切换密码显示">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                    <path class="eye-slash" d="M3 3l18 18"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Base URL</label>
                        <input type="text" class="base-url" placeholder="输入 Base URL">
                    </div>
                    <div class="form-group">
                        <label>显示名称</label>
                        <input type="text" class="display-name" placeholder="输入显示名称（可选）">
                    </div>
                    <div class="form-group">
                        <label>模型名称</label>
                        <input type="text" class="model-name" placeholder="输入模型名称">
                    </div>
                    <div class="form-group">
                        <div class="form-group-header">
                            <label>Temperature</label>
                            <span class="temperature-value">1.0</span>
                        </div>
                        <input type="range" class="temperature" min="0" max="2" step="0.1" value="1">
                    </div>
                    <div class="form-group">
                        <label>自定义参数</label>
                        <textarea class="custom-params" placeholder='例如: {"max_tokens": 8192, "top-k": 1}'></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="prompt-settings">
        <div class="settings-header">
            <button class="back-button">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12 4L6 10L12 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <span class="settings-title">提示词设置</span>
        </div>
        <div class="prompt-settings-content">
            <!-- 基础设置 -->
            <div class="prompt-group">
                <label>系统提示词</label>
                <textarea id="system-prompt" placeholder="输入系统提示词..."></textarea>
            </div>
            <div class="prompt-group">
                <label>快速总结提示词</label>
                <textarea id="summary-prompt" placeholder="输入页面总结时使用的提示词..."></textarea>
            </div>

            <!-- 搜索相关 -->
            <div class="prompt-group">
                <label>划词提示词</label>
                <textarea id="query-prompt" placeholder="输入直接查询时使用的提示词..."></textarea>
            </div>
            <div class="prompt-group">
                <label>联网划词提示词</label>
                <textarea id="selection-prompt" placeholder="输入划词搜索时使用的提示词..."></textarea>
            </div>

            <!-- 内容分析 -->
            <div class="prompt-group">
                <label>PDF快速总结提示词</label>
                <textarea id="pdf-prompt" placeholder="输入PDF文档分析时使用的提示词..."></textarea>
            </div>
            <div class="prompt-group">
                <label>图片默认提示词</label>
                <textarea id="image-prompt" placeholder="输入图片解释时使用的提示词..."></textarea>
            </div>
            
            <!-- 消息折叠设置 -->
            <div class="prompt-group">
                <label>消息折叠正则表达式</label>
                <textarea id="fold-pattern-prompt" placeholder="输入用于折叠消息的正则表达式..."></textarea>
            </div>
            <div class="prompt-group">
                <label>折叠消息摘要文本</label>
                <textarea id="fold-summary-prompt" placeholder="输入折叠消息的摘要文本..."></textarea>
            </div>
            
            <!-- URL规则预设 -->
            <div class="prompt-group">
                <label>URL规则预设</label>
                <div class="url-rules-container">
                    <div id="url-rules-list" class="url-rules-list">
                        <!-- 规则列表将动态生成 -->
                    </div>
                </div>
                <textarea id="url-rules-prompt" style="display: none;"></textarea>
            </div>
            
            <div class="prompt-actions">
                <button id="reset-prompts">恢复默认</button>
                <button id="save-prompts">保存更改</button>
            </div>
        </div>
    </div>
    <div class="image-preview-modal">
        <div class="image-preview-content">
            <img src="" alt="预览图片">
            <button class="image-preview-close">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>
    <script src="/lib/marked.min.js"></script>
    <script src="/lib/highlight.min.js"></script>
    <script src="/lib/katex.min.js"></script>
    <script src="/lib/auto-render.min.js"></script>
    <script type="module" src="/src/ui/sidebar/sidebar.js"></script>
    <script type="module" src="/src/ui/sidebar/sidebar-message-handler.js"></script>
</body>
</html>