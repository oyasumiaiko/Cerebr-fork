// 此次重构已将聊天历史相关功能移动到chat_history_ui.js模块中，但sidebar.js中仍保留了一些冗余函数
// 在后续清理工作中，应删除sidebar.js中的以下函数，因为它们已经有对应的chatHistoryUI模块方法:

// 1. saveCurrentConversation (第1720-1803行):
//    已替换为 chatHistoryUI.saveCurrentConversation

// 2. showChatHistoryPanel (第1804-1888行):
//    已替换为 chatHistoryUI.showChatHistoryPanel

// 3. formatRelativeTime (第1889-1909行):
//    已在chatHistoryUI模块内实现

// 4. getGroupLabel (第1910-1937行):
//    已在chatHistoryUI模块内实现

// 5. loadConversationHistories (第1938-2099行):
//    已在chatHistoryUI模块内实现

// 6. loadConversationIntoChat (第2100-2143行):
//    已替换为 chatHistoryUI.loadConversationIntoChat

// 7. showChatHistoryItemContextMenu (第2160-2198行):
//    已在chatHistoryUI模块内实现

// 以上函数已完全通过chatHistoryUI实例方法进行替换，所有对这些函数的调用都已更新。
// 删除这些函数不会影响程序功能，只会删除冗余代码。

// ---- API设置重构说明 2024-07-23 ----
// API设置相关功能已经重构到api_settings.js模块中，该模块采用工厂函数模式创建API管理器实例。
// 以下功能已经从sidebar.js移动到api_settings.js中:
// 
// 1. loadAPIConfigs - 现在使用apiManager.loadAPIConfigs或apiManager.init
// 2. saveAPIConfigs - 现在使用apiManager.saveAPIConfigs
// 3. renderAPICards - 现在使用apiManager.renderAPICards
// 4. createAPICard - 现在模块内部使用
// 5. renderFavoriteApis - 现在使用apiManager.renderFavoriteApis
//
// 此外，API请求的构建和发送也被抽象为纯函数:
// 1. buildRequest - 负责构建API请求体，与具体API格式解耦
// 2. sendRequest - 负责发送API请求，便于后续扩展不同的API格式
//
// 使用新模块的好处:
// 1. 更好的关注点分离 - API配置管理与UI逻辑分离
// 2. 更容易复用 - 可以在不同模块中使用API管理功能
// 3. 更易于测试 - 纯函数设计使单元测试更简单
// 4. 更好的可扩展性 - 可以更容易地添加对非OpenAI格式API的支持

// ---- 消息发送模块重构说明 2024-07-23 ----
// 创建了新的 message_sender.js 模块，专门负责消息的构建、发送和处理。
// 以下功能已经从sidebar.js移动到message_sender.js中:
//
// 1. sendMessage - 核心消息发送功能，现在使用messageSender.sendMessage()
// 2. performQuickSummary - 快速总结功能，现在使用messageSender.performQuickSummary()
// 3. enterTemporaryMode/exitTemporaryMode - 临时模式管理，现在使用messageSender的相关方法
// 4. getPageContent - 获取网页内容，现在在messageSender内部实现
// 5. 流式响应处理 - 现在由messageSender.handleStreamResponse处理
// 
// 移除的辅助函数:
// 1. updateAIMessage - 现在由messageSender内部调用messageProcessor
// 2. getDocumentType - 现在由messageSender内部实现
// 3. processImageTags - 已完全由imageHandler和messageProcessor处理
// 4. extractSystemContent - 已由messageProcessor处理
//
// 消息发送模块的优势:
// 1. 更清晰的责任分配 - 整个消息生命周期由专门模块处理
// 2. 降低耦合 - 与UI操作和DOM元素耦合度更低
// 3. 更好的状态管理 - isProcessingMessage、currentController等状态封装在模块内
// 4. 更易测试 - 可以独立测试消息发送逻辑
// 5. 更好的API集成 - 与apiManager无缝集成

// ---- 设置管理模块重构说明 2024-07-24 ----
// 创建了新的 settings_manager.js 模块，负责管理所有用户界面设置。
// 以下功能已从sidebar.js移动到settings_manager.js中:
//
// 1. initSettings - 初始化所有设置，现在由settingsManager.init处理
// 2. saveSettings - 保存单个设置，现在由settingsManager的各种setter方法处理
// 3. setTheme/initTheme - 主题设置相关，现在由settingsManager.setTheme和applyTheme处理
// 4. updateReferenceVisibility - 引用标记可见性，现在由settingsManager.updateReferenceVisibility处理
//
// 移除的UI事件监听:
// 1. 侧边栏宽度滑块事件 - 现在由settingsManager内部管理
// 2. 字体大小滑块事件 - 现在由settingsManager内部管理
// 3. 缩放比例滑块事件 - 现在由settingsManager内部管理
// 4. 自动滚动开关事件 - 现在由settingsManager内部管理
// 5. 划词搜索清空聊天开关事件 - 现在由settingsManager内部管理
// 6. 主题系统变化监听 - 现在由settingsManager内部管理
//
// 设置管理模块的优势:
// 1. 集中管理 - 所有设置相关的逻辑集中在一个模块，避免散布在多处
// 2. 一致的接口 - 统一的设置获取和设置方法
// 3. 降低耦合 - 分离UI操作和设置逻辑
// 4. 简化sidebar.js - 大幅减少主文件的代码量
// 5. 更易扩展 - 添加新设置时只需修改settings_manager.js
//
// 此重构移除了超过150行代码，使sidebar.js更加精简和聚焦于核心功能。
// 设置的统一管理模式可以作为未来其他UI行为模块化的参考。

// ---- UI模块重构说明 2024-07-25 ----
// 进一步将sidebar.js中的UI处理逻辑分解为两个新模块:
//
// 1. context_menu_manager.js - 专门处理右键菜单相关功能
//    - 移除的函数:
//      * showContextMenu - 显示上下文菜单
//      * hideContextMenu - 隐藏上下文菜单
//      * copyMessageContent - 复制消息内容
//      * copyCodeContent - 复制代码内容
//      * 相关事件监听器
//
// 2. ui_manager.js - 处理其他UI交互逻辑
//    - 移除的函数:
//      * adjustTextareaHeight - 自动调整文本框高度 
//      * updateSendButtonState - 更新发送按钮状态
//      * toggleSettingsMenu - 切换设置菜单显示
//      * closeExclusivePanels - 关闭互斥面板
//      * 各种事件监听器
//
// 重构优势:
// 1. 进一步降低耦合度 - UI逻辑与业务逻辑分离
// 2. 提高代码组织性 - 相关功能聚集在一起
// 3. 简化主文件 - sidebar.js现在主要负责模块初始化和协调
// 4. 更好的可测试性 - UI行为可以独立测试
// 5. 提高可维护性 - 修改UI行为不需要修改核心逻辑
//
// 这次重构又减少了约180行代码，使sidebar.js更加精简，更好地体现了
// "关注点分离"原则。模块化设计显著减轻了心智负担，使开发者可以聚焦
// 于特定功能区域而不必理解整个庞大的文件。
